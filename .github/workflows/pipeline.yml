name: Notion Pipeline

on:
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã®ã¿ï¼ˆActionsã‚¿ãƒ–ã‹ã‚‰å®Ÿè¡Œï¼‰

jobs:
  run-pipeline:
    runs-on: ubuntu-latest

    env:
      NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
      NOTION_DB_ID: ${{ secrets.NOTION_DB_ID }}
      SERVICE_ACCOUNT_FILE: ${{ github.workspace }}/sa.json
      CSV_PATH: ${{ github.workspace }}/data/ChatGPT_Merge_master.csv
      LOG_DIR: ${{ github.workspace }}/logs

    steps:
      - name: ğŸ“¦ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸ Pythonã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: ğŸ”§ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          pip install --upgrade pip
          pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib requests

      - name: ğŸ—‚ï¸ ãƒ‡ãƒ¼ã‚¿ã¨ãƒ­ã‚°ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ
        run: |
          mkdir -p data logs
          echo "ãƒ•ã‚©ãƒ«ãƒ€æº–å‚™OK"

      - name: ğŸ”‘ Googleã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSONã‚’å±•é–‹
        run: |
          echo '${{ secrets.GDRIVE_SERVICE_JSON }}' > sa.json
          echo "âœ… ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSON å±•é–‹å®Œäº†"

      - name: â–¶ï¸ å®Ÿè¡Œ - Notion Pipeline
        run: |
          python3 run_pipeline_local_safe.py
